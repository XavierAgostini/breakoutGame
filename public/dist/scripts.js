"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}();console.log("working");var canvas=document.getElementById("myCanvas"),canvasWidth=500,canvasHeight=800,ctx=canvas.getContext("2d"),interval=10,lifeLost=new Event("lifeLost"),gameOver=new Event("gameOver"),Game=function(){function t(){_classCallCheck(this,t),this.canvasOffset=canvas.getBoundingClientRect().left,this.scoreBoard=new ScoreBoard,this.highScore=0,this.numLives=3,this.blockWidth=43,this.blockHeight=25,this.blocks=new Blocks(this.scoreBoard),this.paddle=new Paddle((canvasWidth-100)/2,canvasHeight-40),this.ball=new Ball(canvasWidth/2,400),this.gameInterval;var e=this;document.addEventListener("lifeLost",function(t){e.lifeLost()}),document.addEventListener("gameOver",function(t){e.gameOver()});var s=document.getElementById("newGameBtn");s.addEventListener("click",function(t){s.style.display="none",e.startGame(),e.blocks.resetBlocks()})}return _createClass(t,[{key:"writeScore",value:function(){var t="Score: "+this.scoreBoard.score,e="Lives: "+this.numLives;ctx.font="30px sans-serif",ctx.fillText(t,10,25),ctx.fillText(e,350,25)}},{key:"lifeLost",value:function(){this.numLives--,0==this.numLives&&this.gameOver()}},{key:"gameOver",value:function(){console.log("Game Over"),clearInterval(this.gameInterval);var t=this;setTimeout(function(){ctx.clearRect(0,0,canvasWidth,canvasHeight);var e=t.scoreBoard.highScore;t.scoreBoard.highScore=t.scoreBoard.score>e?t.scoreBoard.score:e,t.scoreBoard.updateHighScore(t.scoreBoard.highScore),newGameBtn.style.display="inline";var s="GAME OVER",i="Score: "+t.scoreBoard.score,a="High score: "+t.scoreBoard.highScore;ctx.font="30px sans-serif",ctx.fillText(s,150,50),ctx.fillText(i,150,150),ctx.fillText(a,150,200)},interval)}},{key:"startGame",value:function(){var t=this;this.scoreBoard.score=0,this.numLives=3,this.gameInterval=setInterval(function(){t.drawScreen()},interval)}},{key:"drawBlocks",value:function(){for(var t=0;t<this.blocks.blockArr.length;t++){var e=this.blocks.blockArr[t];e.active&&(ctx.fillStyle=e.colour,ctx.fillRect(e.posX,e.posY,e.width,e.height))}}},{key:"drawPaddle",value:function(){ctx.fillStyle=this.paddle.colour,ctx.fillRect(this.paddle.posX,this.paddle.posY,this.paddle.width,this.paddle.height)}},{key:"drawBall",value:function(){ctx.beginPath(),ctx.arc(this.ball.posX,this.ball.posY,this.ball.radius,0,2*Math.PI,!1),ctx.fillStyle=this.ball.colour,ctx.fill(),ctx.stroke()}},{key:"drawScreen",value:function(){ctx.clearRect(0,0,canvasWidth,canvasHeight),this.paddle.updatePosition(),this.ball.ballPhysics(canvasWidth,canvasHeight,this.paddle,this.blocks),this.blocks.updateBlocks(this.ball),this.writeScore(),this.drawBlocks(),this.drawPaddle(),this.drawBall()}}]),t}(),ScoreBoard=function(){function t(){_classCallCheck(this,t),this.score=0,this.highScore=localStorage.getItem("highScore")||0}return _createClass(t,[{key:"updateScore",value:function(t){this.score+=t}},{key:"updateHighScore",value:function(t){localStorage.setItem("highScore",t)}},{key:"get",value:function(t){return this[t]}}]),t}(),Ball=function(){function t(e,s){_classCallCheck(this,t),this.colour="white",this.radius=10,this.posX=e,this.posY=s,this.velX=0,this.velY=.2}return _createClass(t,[{key:"ballPhysics",value:function(t,e,s,i){if(this.posY+=this.velY*interval,this.posX+=this.velX*interval,this.posY+this.radius>=e&&(console.log("bottom wall hit"),this.posY=400,this.posX=t/2,this.velX=0,document.dispatchEvent(lifeLost)),this.posY-this.radius<=0&&(console.log("top wall hit -a"),this.velY*=-1),this.posX+this.radius>=t&&(console.log("right wall hit -a"),this.velX*=-1),this.posX-this.radius<=0&&(console.log("left wall hit -a"),this.velX*=-1),this.posY>=e-s.height-s.heightOffset&&this.posX-this.radius<=s.posX+s.width&&this.posX+this.radius>=s.posX){console.log("paddle hit -a"),this.velY*=-1;var a=this.posX/(s.posX+.5*s.width)-1;this.velX=a>.5?.5:a}}},{key:"get",value:function(t){return this[t]}}]),t}(),Paddle=function(){function t(e,s){_classCallCheck(this,t),this.colour="black",this.width=100,this.height=15,this.heightOffset=40,this.posX=e,this.posY=s,this.velX=0,this.speed=.5,this.canvasOffset=canvas.getBoundingClientRect().left;var i=this;document.addEventListener("keydown",function(t){37==t.keyCode?i.velX=-i.speed:39==t.keyCode&&(i.velX=i.speed)}),document.addEventListener("keyup",function(t){37!=t.keyCode&&39!=t.keyCode||(i.velX=0)}),canvas.addEventListener("mousemove",function(t){var e=t.clientX-i.canvasOffset;i.posX=e})}return _createClass(t,[{key:"updatePosition",value:function(){this.posX+=this.velX*interval,this.posX=this.posX>=canvasWidth-this.width?canvasWidth-this.width:this.posX,this.posX=this.posX<=0?0:this.posX}},{key:"get",value:function(t){return this[t]}}]),t}(),Block=function(){function t(e,s,i,a,o,l,c,n){_classCallCheck(this,t),this.id=e,this.level=s,this.active=i,this.colour=a,this.posX=o,this.posY=l,this.width=c,this.height=n}return _createClass(t,[{key:"get",value:function(t){return this[t]}},{key:"blockHit",value:function(t){var e=!1,s=this.posY+this.height;if(t.posY-t.radius<=s&&this.active)for(var i=0;i<360;i++){var a=t.posX+t.radius*Math.cos(i*Math.PI/180),o=t.posY-t.radius*Math.sin(i*Math.PI/180);if(a>=this.posX&&a<=this.posX+this.width&&o<=this.posY+this.height&&o>=this.posY){e=!0,t.velY*=-1;break}}return!!e&&(this.active=!1,!0)}}]),t}(),Blocks=function(){function t(e){_classCallCheck(this,t),this.scoreBoard=e,this.blockArr=this.generateBlocks()}return _createClass(t,[{key:"generateBlocks",value:function(){for(var t=43,e=25,s=0,i=0,a=["red","#064df1","#33f106","#8037dd","yellow"],o=0,l=[],c=0;c<5;c++){s=12,i+=e+5;for(var n=0;n<10;n++){var r=new Block(o,c,(!0),a[c],s,i,t,e);l.push(r),s+=t+5,o++}}return l}},{key:"resetBlocks",value:function(){for(var t=0;t<this.blockArr.length;t++)this.blockArr[t].active=!0}},{key:"updateBlocks",value:function(t){for(var e=0,s=!1,i=0;i<this.blockArr.length;i++)this.blockArr[i].active&&this.blockArr[i].blockHit(t)&&(e++,e>1&&(t.velY*=-1),this.scoreBoard.updateScore(40-10*this.blockArr[i].level+1)),s=!this.blockArr[i].active;s&&(console.log("over"),document.dispatchEvent(gameOver))}},{key:"get",value:function(t){return console.log(t),this[t]}}]),t}(),game=new Game;game.startGame();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJyZWFrb3V0LmpzIl0sIm5hbWVzIjpbImNvbnNvbGUiLCJsb2ciLCJjYW52YXMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY2FudmFzV2lkdGgiLCJjYW52YXNIZWlnaHQiLCJjdHgiLCJnZXRDb250ZXh0IiwibGlmZUxvc3QiLCJFdmVudCIsIkdhbWUiLCJ0aGlzIiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwibGVmdCIsIlNjb3JlQm9hcmQiLCJoaWdoU2NvcmUiLCJudW1MaXZlcyIsImNhbnZhc09mZnNldCIsImJsb2NrSGVpZ2h0IiwiYmxvY2tzIiwiQmxvY2tzIiwic2NvcmVCb2FyZCIsIlBhZGRsZSIsImJsb2NrV2lkdGgiLCJCYWxsIiwidCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImdhbWVPdmVyIiwibmV3R2FtZUJ0biIsInJlc2V0QmxvY2tzIiwiZGlzcGxheSIsInN0YXJ0R2FtZSIsImZpbGxUZXh0IiwibGl2ZU1lc3NhZ2UiLCJzY29yZU1lc3NhZ2UiLCJjbGVhckludGVydmFsIiwiZ2FtZUludGVydmFsIiwic2V0VGltZW91dCIsImNsZWFyUmVjdCIsImN1cnJIaWdoU2NvcmUiLCJzY29yZSIsInVwZGF0ZUhpZ2hTY29yZSIsInN0eWxlIiwibWVzc2FnZTEiLCJtZXNzYWdlMyIsIm1lc3NhZ2UyIiwic2V0SW50ZXJ2YWwiLCJkcmF3U2NyZWVuIiwiaW50ZXJ2YWwiLCJpIiwiYmxvY2tBcnIiLCJsZW5ndGgiLCJibG9jayIsImFjdGl2ZSIsImZpbGxTdHlsZSIsImNvbG91ciIsImZpbGxSZWN0IiwicG9zWCIsInBvc1kiLCJ3aWR0aCIsImhlaWdodCIsInBhZGRsZSIsImJlZ2luUGF0aCIsImJhbGwiLCJyYWRpdXMiLCJNYXRoIiwiUEkiLCJmaWxsIiwic3Ryb2tlIiwidXBkYXRlUG9zaXRpb24iLCJiYWxsUGh5c2ljcyIsInVwZGF0ZUJsb2NrcyIsIndyaXRlU2NvcmUiLCJkcmF3UGFkZGxlIiwiYXJjIiwiX2NsYXNzQ2FsbENoZWNrIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsImRyYXdCbG9ja3MiLCJwcm9wZXJ0eSIsInZlbFkiLCJ2ZWxYIiwic2V0SXRlbSIsImRpc3BhdGNoRXZlbnQiLCJoZWlnaHRPZmZzZXQiLCJzcGVlZCIsImtleUNvZGUiLCJ4IiwiQmxvY2siLCJpZCIsImxldmVsIiwiYmxvY2tTZWN0aW9uIiwiY29zIiwieSIsInNpbiIsImhpdCIsImdlbmVyYXRlQmxvY2tzIiwiYmxvY2tDb2xvdXJzIiwiaW5kZXgiLCJibG9ja0FycmF5IiwiaiIsIm11bHRpSGl0cyIsIm5vTW9yZUJsb2NrcyIsImJsb2NrSGl0IiwidXBkYXRlU2NvcmUiLCJnYW1lIl0sIm1hcHBpbmdzIjoiNFhBQUFBLFNBQVFDLElBQUksVUFFWixJQUFJQyxRQUFTQyxTQUFTQyxlQUFlLFlBQ2pDQyxZQUFjLElBQ2RDLGFBQWUsSUFDZkMsSUFBTUwsT0FBT00sV0FBVyxNQUw1QlIsU0FBWSxHQUNaUyxTQUFBLEdBQUFDLE9BQUEsWUFDSVIsU0FBU0MsR0FBQUEsT0FBU0MsWUFFbEJFLGdCQUNKLFFBQUFLLEtBQVVULGdCQUFBQSxLQUFBQSxHQUVWVSxLQUFJSCxhQUFlQyxPQUFNRyx3QkFBekJDLEtBU0VGLEtBTklELFdBTWMsR0FBSUksWUFMdkJILEtBQUFJLFVBQWMsRUFBQUosS0FBQUssU0FBQSxFQUViTCxLQUFLTSxXQUFMLEdBU0FOLEtBQUtPLFlBQWMsR0FQbkJQLEtBQUFRLE9BQUEsR0FBQUMsUUFBQVQsS0FBQVUsWUFHQVYsS0FBS0ssT0FBTCxHQUFBTSxTQUFBbEIsWUFBQSxLQUFBLEVBQUFDLGFBQUEsSUFHQU0sS0FBS1ksS0FBQUEsR0FBTEMsTUFBQXBCLFlBQUEsRUFBQSxLQUVBTyxLQUFLUSxZQVNMLElBQUlNLEdBQUlkLElBUFJULFVBQUF3QixpQkFBQSxXQUFBLFNBQUFDLEdBQ0FGLEVBQUFqQixhQUVBTixTQUFBd0IsaUJBQUEsV0FBQSxTQUFBQyxHQUNBRixFQUFBRyxZQUVBLElBQUFDLEdBQUEzQixTQUFB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QSxFQUFBQSxFQUFBLEVBQUFBLElBQUEsQ0ErQ0NRLEVBQU8sR0FDUEMsR0FBUUUsRUFBUyxDQUNqQixLQUFJLEdBQUl3QyxHQUFJLEVBQUdBLEVBQUksR0FBSUEsSUFBSyxDQTlDN0IsR0FBSUwsR0FBTSxHQUFWUCxPQUFBVSxFQUFBakQsSUFBQSxHQUFBZ0QsRUFBQWhELEdBQUFRLEVBQUFDLEVBQUFDLEVBQUFDLEVBQ0F1QyxHQUFJUixLQUFBQSxHQWdERmxDLEdBQVFFLEVBQVEsRUE5Q2xCdUMsS0FvREEsTUFBT0MseUNBNUNISixJQUFBQSxHQUFBQSxHQUFNLEVBQU45QyxFQUFBdkMsS0FBQXdDLFNBQUFDLE9BQUFGLElBQ0FjLEtBQUFBLFNBQUFkLEdBQWFJLFFBQWIsdUNBR0FVLEdBR0gsSUFBQSxHQUZFc0MsR0FBQSxFQUNEQyxHQUFBLEVBQ0RyRCxFQUFBLEVBQUFBLEVBQUF2QyxLQUFBd0MsU0FBQUMsT0FBQUYsSUFFQXZDLEtBQUsyQyxTQUFTSixHQUFkSSxRQUFBM0MsS0FBQXdDLFNBQUFELEdBQUFzRCxTQUFBeEMsS0FDQXNDLElBQ0FBLEVBQUEsSUFBQXRDLEVBQUFpQixPQUFBLEdBQ0R0RSxLQUFBVSxXQUFBb0YsWUFBQSxHQUFBLEdBQUE5RixLQUFBd0MsU0FBQUQsR0FBQXlDLE1BQUEsSUFpRENZLEdBQWU1RixLQUFLd0MsU0FBU0QsR0FBR0ksTUFHOUJpRCxLQUNGeEcsUUFBUUMsSUFBSSxRQUNaRSxTQUFTa0YsY0FBY3hELHVDQWhEeEJvRCxHQUVBLE1BREFqRixTQUFLb0QsSUFBQUEsR0FDTHhDLEtBQUFxRSxZQTBERTBCLEtBQU8sR0FBSWhHLEtBQ2ZnRyxNQUFLMUUiLCJmaWxlIjoic2NyaXB0cy5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnNvbGUubG9nKCd3b3JraW5nJyk7XG4vLyBHbG9iYWwgVmFyaWFibGVzXG52YXIgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJteUNhbnZhc1wiKTtcbnZhciBjYW52YXNXaWR0aCA9IDUwMDtcbnZhciBjYW52YXNIZWlnaHQgPSA4MDA7XG52YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG52YXIgaW50ZXJ2YWwgPSAxMDtcbnZhciBsaWZlTG9zdCA9IG5ldyBFdmVudCgnbGlmZUxvc3QnKTtcbnZhciBnYW1lT3ZlciA9IG5ldyBFdmVudCgnZ2FtZU92ZXInKTtcblxuY2xhc3MgR2FtZSB7XG5cdGNvbnN0cnVjdG9yKCkge1xuXHRcdC8vIEdhbWUgU2NyZWVuXG5cdFx0dGhpcy5jYW52YXNPZmZzZXQgPSBjYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdDtcblx0XG5cdFx0Ly8gR2FtZSBTZXR0aW5nc1xuXHRcdHRoaXMuc2NvcmVCb2FyZCA9IG5ldyBTY29yZUJvYXJkKCk7XG5cdFx0dGhpcy5oaWdoU2NvcmUgPSAwO1xuXHRcdHRoaXMubnVtTGl2ZXMgPSAzO1xuXHRcdFxuXHRcdC8vIEJsb2NrcyBpbml0aWFsaXplZFxuXHRcdHRoaXMuYmxvY2tXaWR0aCA9IDQzO1xuXHRcdHRoaXMuYmxvY2tIZWlnaHQgPSAyNTtcblx0XHR0aGlzLmJsb2NrcyA9ICBuZXcgQmxvY2tzKHRoaXMuc2NvcmVCb2FyZCk7XG5cblx0XHQvLyBQYWRkbGUgaW5pdGlhbGl6ZWQgaW4gdGhlIGJvdHRvbSBtaWRkbGUgb2Ygc2NyZWVuXG5cdFx0dGhpcy5wYWRkbGUgPSBuZXcgUGFkZGxlKChjYW52YXNXaWR0aCAtIDEwMCkvMiwgY2FudmFzSGVpZ2h0IC0gNDApO1xuXG5cdFx0Ly8gQmFsbCBpbml0aWFsaXplZFxuXHRcdHRoaXMuYmFsbCA9IG5ldyBCYWxsKGNhbnZhc1dpZHRoLzIsIDQwMCk7XG5cblx0XHR0aGlzLmdhbWVJbnRlcnZhbDtcblx0XHR2YXIgdCA9IHRoaXM7XG5cdFx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbGlmZUxvc3QnLCBmdW5jdGlvbihldmVudCkge1xuXHRcdFx0dC5saWZlTG9zdCgpO1xuXHRcdH0pO1xuXHRcdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2dhbWVPdmVyJywgZnVuY3Rpb24oZXZlbnQpIHtcblx0XHRcdHQuZ2FtZU92ZXIoKTtcblx0XHR9KTtcblx0XHR2YXIgbmV3R2FtZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibmV3R2FtZUJ0blwiKTtcblx0XHRuZXdHYW1lQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbihldmVudCkge1xuXHRcdFx0bmV3R2FtZUJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cdFx0XHR0LnN0YXJ0R2FtZSgpO1xuXHRcdFx0dC5ibG9ja3MucmVzZXRCbG9ja3MoKTtcblx0XHR9KTtcblx0fVxuXG5cdHdyaXRlU2NvcmUoKSB7XG5cdFx0dmFyIHNjb3JlTWVzc2FnZSA9IFwiU2NvcmU6IFwiICsgdGhpcy5zY29yZUJvYXJkLnNjb3JlO1xuXHRcdHZhciBsaXZlTWVzc2FnZSA9IFwiTGl2ZXM6IFwiICsgdGhpcy5udW1MaXZlcztcblx0XHRjdHguZm9udCA9IFwiMzBweCBzYW5zLXNlcmlmXCI7XG5cdFx0Y3R4LmZpbGxUZXh0KHNjb3JlTWVzc2FnZSwgMTAsIDI1KTtcblx0XHRjdHguZmlsbFRleHQobGl2ZU1lc3NhZ2UsIDM1MCwgMjUpO1xuXHR9XG5cblx0bGlmZUxvc3QoKSB7XG5cdFx0dGhpcy5udW1MaXZlcy0tO1xuXHRcdGlmKHRoaXMubnVtTGl2ZXMgPT0gMCkge1xuXHRcdFx0dGhpcy5nYW1lT3ZlcigpO1xuXHRcdH1cdFxuXHR9XG5cdGdhbWVPdmVyKCkge1xuXHRcdGNvbnNvbGUubG9nKFwiR2FtZSBPdmVyXCIpO1xuXHRcdGNsZWFySW50ZXJ2YWwodGhpcy5nYW1lSW50ZXJ2YWwpO1xuXHRcdHZhciB0ID0gdGhpcztcblx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0Ly8gQ2xlYXIgQ2FudmFzXG5cdFx0XHRjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhc1dpZHRoLCBjYW52YXNIZWlnaHQpO1xuXG5cdFx0XHRcblxuXHRcdFx0dmFyIGN1cnJIaWdoU2NvcmUgPSB0LnNjb3JlQm9hcmQuaGlnaFNjb3JlO1xuXHRcdFx0dC5zY29yZUJvYXJkLmhpZ2hTY29yZSA9IHQuc2NvcmVCb2FyZC5zY29yZSA+ICBjdXJySGlnaFNjb3JlID8gdC5zY29yZUJvYXJkLnNjb3JlIDogY3VyckhpZ2hTY29yZTtcblx0XHRcdHQuc2NvcmVCb2FyZC51cGRhdGVIaWdoU2NvcmUodC5zY29yZUJvYXJkLmhpZ2hTY29yZSk7XG5cdFx0XHRuZXdHYW1lQnRuLnN0eWxlLmRpc3BsYXkgPSBcImlubGluZVwiO1xuXHRcdFx0XG5cdFx0XHR2YXIgbWVzc2FnZTEgPSBcIkdBTUUgT1ZFUlwiO1xuXHRcdFx0dmFyIG1lc3NhZ2UyID0gXCJTY29yZTogXCIgKyB0LnNjb3JlQm9hcmQuc2NvcmU7IFxuXHRcdFx0dmFyIG1lc3NhZ2UzID0gXCJIaWdoIHNjb3JlOiBcIiArIHQuc2NvcmVCb2FyZC5oaWdoU2NvcmU7XG5cdFx0XHRcblx0XHRcdGN0eC5mb250ID0gXCIzMHB4IHNhbnMtc2VyaWZcIjtcblx0XHRcdGN0eC5maWxsVGV4dChtZXNzYWdlMSwgMTUwLCA1MCk7XG5cdFx0XHRjdHguZmlsbFRleHQobWVzc2FnZTIsIDE1MCwgMTUwKTtcblx0XHRcdGN0eC5maWxsVGV4dChtZXNzYWdlMywgMTUwLCAyMDApO1xuXHRcdH0sIGludGVydmFsKTtcdFxuXHR9XG5cblx0c3RhcnRHYW1lKCkge1xuXHRcdHZhciB0ID0gdGhpcztcblx0XHR0aGlzLnNjb3JlQm9hcmQuc2NvcmUgPSAwO1xuXHRcdHRoaXMubnVtTGl2ZXMgPSAzO1xuXHRcdHRoaXMuZ2FtZUludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7dC5kcmF3U2NyZWVuKCl9LCBpbnRlcnZhbCk7XG5cdH1cblxuXHRkcmF3QmxvY2tzKCkge1xuXHRcdGZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLmJsb2Nrcy5ibG9ja0Fyci5sZW5ndGg7IGkrKykge1xuXHRcdFx0dmFyIGJsb2NrID0gdGhpcy5ibG9ja3MuYmxvY2tBcnJbaV07XG5cdFx0XHRpZihibG9jay5hY3RpdmUpIHtcblx0XHRcdFx0Y3R4LmZpbGxTdHlsZSA9IGJsb2NrLmNvbG91cjtcblx0XHRcdFx0Y3R4LmZpbGxSZWN0KGJsb2NrLnBvc1gsIGJsb2NrLnBvc1ksIGJsb2NrLndpZHRoLCBibG9jay5oZWlnaHQpO1xuXHRcdFx0fVx0XG5cdFx0fSAgICAgXG5cdH1cblxuXHRkcmF3UGFkZGxlKCkge1xuXHRcdGN0eC5maWxsU3R5bGUgPSB0aGlzLnBhZGRsZS5jb2xvdXI7XG5cdFx0Y3R4LmZpbGxSZWN0KHRoaXMucGFkZGxlLnBvc1gsIHRoaXMucGFkZGxlLnBvc1ksIHRoaXMucGFkZGxlLndpZHRoLCB0aGlzLnBhZGRsZS5oZWlnaHQpO1xuXG5cdH1cblxuXHRkcmF3QmFsbCgpIHtcblx0XHRjdHguYmVnaW5QYXRoKCk7XG5cdFx0Ly9jZW50ZXIoeCx5KSwgc3RhcnQgcmFkaWFuLCBlbmQgcmFkaWFuXG5cdFx0Y3R4LmFyYyh0aGlzLmJhbGwucG9zWCwgdGhpcy5iYWxsLnBvc1ksIHRoaXMuYmFsbC5yYWRpdXMsIDAgLCAyKk1hdGguUEksIGZhbHNlKTtcblx0XHRjdHguZmlsbFN0eWxlID0gdGhpcy5iYWxsLmNvbG91cjtcblx0XHRjdHguZmlsbCgpO1xuXHRcdGN0eC5zdHJva2UoKTtcblx0fVxuXG5cdGRyYXdTY3JlZW4oKSB7XG5cdFx0Ly9jbGVhciBjYW52YXMgYmVmb3JlIHJlZHJhd2luZ1xuXHRcdGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzV2lkdGgsIGNhbnZhc0hlaWdodCk7XG5cblx0XHR0aGlzLnBhZGRsZS51cGRhdGVQb3NpdGlvbigpO1xuXHRcdHRoaXMuYmFsbC5iYWxsUGh5c2ljcyhjYW52YXNXaWR0aCwgY2FudmFzSGVpZ2h0LCB0aGlzLnBhZGRsZSwgdGhpcy5ibG9ja3MpO1xuXHRcdHRoaXMuYmxvY2tzLnVwZGF0ZUJsb2Nrcyh0aGlzLmJhbGwpO1xuXHRcdHRoaXMud3JpdGVTY29yZSgpO1xuXHRcdHRoaXMuZHJhd0Jsb2NrcygpO1xuXHRcdHRoaXMuZHJhd1BhZGRsZSgpO1xuXHRcdHRoaXMuZHJhd0JhbGwoKTtcblx0XHRcblx0fVxuXG5cdFxufVxuXG5jbGFzcyBTY29yZUJvYXJkIHtcblx0Y29uc3RydWN0b3IoKSB7XG5cdFx0dGhpcy5zY29yZSA9IDA7XG5cdFx0dGhpcy5oaWdoU2NvcmUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImhpZ2hTY29yZVwiKSB8fCAwO1xuXHR9XG5cdHVwZGF0ZVNjb3JlKHNjb3JlKSB7XG5cdFx0dGhpcy5zY29yZSArPSBzY29yZTtcblx0fVxuXHR1cGRhdGVIaWdoU2NvcmUoc2NvcmUpIHtcblx0XHRsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImhpZ2hTY29yZVwiLCBzY29yZSk7XG5cdH1cblx0Z2V0KHByb3BlcnR5KSB7XG5cdFx0cmV0dXJuIHRoaXNbcHJvcGVydHldO1xuXHR9XG59XG5cbmNsYXNzIEJhbGwge1xuXHRjb25zdHJ1Y3Rvcihwb3NYLCBwb3NZKSB7XG5cdFx0dGhpcy5jb2xvdXIgPSAnd2hpdGUnO1xuXHRcdHRoaXMucmFkaXVzID0gMTA7XG5cdFx0dGhpcy5wb3NYID0gcG9zWDtcblx0XHR0aGlzLnBvc1kgPSBwb3NZO1xuXHRcdHRoaXMudmVsWCA9IDA7XG5cdFx0dGhpcy52ZWxZID0gMC4yO1xuXHR9XG5cdC8qIFVwZGF0ZSBiYWxsIHBvc2l0aW9uIG9uIGNhbnZhcyovXG5cdGJhbGxQaHlzaWNzKGNhbnZhc1dpZHRoLCBjYW52YXNIZWlnaHQsIHBhZGRsZSwgYmxvY2tzKSB7XG5cdFx0dmFyIGJvdHRvbVdhbGxIaXQgPSBmYWxzZTtcblx0XHQvLyBVcGRhdGUgQmFsbCBwb3NpdGlvblxuXHRcdHRoaXMucG9zWSArPSB0aGlzLnZlbFkgKiBpbnRlcnZhbDtcblx0XHR0aGlzLnBvc1ggKz0gdGhpcy52ZWxYICogaW50ZXJ2YWw7XG5cdFx0XG5cdFx0Ly9pZiBiYWxsIGhpdHMgYm90dG9tIHdhbGxcblx0XHRpZih0aGlzLnBvc1kgKyB0aGlzLnJhZGl1cyA+PSBjYW52YXNIZWlnaHQpIHtcblx0XHRcdGNvbnNvbGUubG9nKCdib3R0b20gd2FsbCBoaXQnKTtcblx0XHRcdHRoaXMucG9zWSA9IDQwMDtcblx0XHRcdHRoaXMucG9zWCA9IGNhbnZhc1dpZHRoLzI7XG5cdFx0XHR0aGlzLnZlbFggPSAwO1xuXHRcdFx0Ly8gdGhpcy52ZWxZICo9IC0xO1xuXHRcdFx0ZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChsaWZlTG9zdCk7XG5cblx0XHR9XG5cblx0XHQvL2lmIGJhbGwgaGlzdCB0b3Agd2FsbFxuXHRcdGlmKHRoaXMucG9zWSAtIHRoaXMucmFkaXVzIDw9IDApIHtcblx0XHRcdGNvbnNvbGUubG9nKCd0b3Agd2FsbCBoaXQgLWEnKTtcblx0XHRcdHRoaXMudmVsWSAqPSAtMTtcblx0XHR9XG5cblx0XHQvL2lmIHZhbGwgaGl0cyByaWdodCB3YWxsXG5cdFx0aWYodGhpcy5wb3NYICsgdGhpcy5yYWRpdXMgPj0gY2FudmFzV2lkdGgpIHtcblx0XHRcdGNvbnNvbGUubG9nKCdyaWdodCB3YWxsIGhpdCAtYScpO1xuXHRcdFx0dGhpcy52ZWxYICo9IC0xO1xuXHRcdH1cblxuXHRcdC8vaWYgYmFsbCBoaXRzIGxlZnQgd2FsbFxuXHRcdGlmKHRoaXMucG9zWCAtIHRoaXMucmFkaXVzIDw9IDApIHtcblx0XHRcdGNvbnNvbGUubG9nKCdsZWZ0IHdhbGwgaGl0IC1hJyk7XG5cdFx0XHR0aGlzLnZlbFggKj0gLTE7XG5cdFx0fVxuXG5cblx0XHQvL2JhbGwgYXQgcGFkZGxlIGxldmVsXG5cdFx0aWYodGhpcy5wb3NZID49IGNhbnZhc0hlaWdodCAtIHBhZGRsZS5oZWlnaHQgLSBwYWRkbGUuaGVpZ2h0T2Zmc2V0KSB7XG5cdFx0XHQvL2JhbGwgaGl0cyBwYWRkbGVcblx0XHRcdGlmKCh0aGlzLnBvc1ggLSB0aGlzLnJhZGl1cyA8PSBwYWRkbGUucG9zWCArIHBhZGRsZS53aWR0aCkgJiYgKHRoaXMucG9zWCArIHRoaXMucmFkaXVzID49IHBhZGRsZS5wb3NYKSkge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhcInBhZGRsZSBoaXQgLWFcIik7XG5cdFx0XHRcdHRoaXMudmVsWSAqPSAtMTtcblx0XHRcdFx0dmFyIHNwZWVkID0gdGhpcy5wb3NYLyhwYWRkbGUucG9zWCArIDAuNSpwYWRkbGUud2lkdGgpIC0gMTtcblx0XHRcdFx0dGhpcy52ZWxYID0gc3BlZWQgPiAwLjUgPyAwLjUgOiBzcGVlZDtcblx0XHRcdH1cblx0XHR9XG5cblxuXHR9XG5cblx0Z2V0KHByb3BlcnR5KSB7XG5cdFx0cmV0dXJuIHRoaXNbcHJvcGVydHldO1xuXHR9XG5cbn1cbiBcbmNsYXNzIFBhZGRsZSB7XG5cdGNvbnN0cnVjdG9yKHBvc1gsIHBvc1kpIHtcblx0XHR0aGlzLmNvbG91ciA9ICdibGFjayc7XG5cdFx0dGhpcy53aWR0aCA9IDEwMDtcblx0XHR0aGlzLmhlaWdodCA9IDE1O1xuXHRcdHRoaXMuaGVpZ2h0T2Zmc2V0ID0gNDA7XG5cdFx0dGhpcy5wb3NYID0gcG9zWDtcblx0XHR0aGlzLnBvc1kgPSBwb3NZO1xuXHRcdHRoaXMudmVsWCA9IDA7XG5cdFx0dGhpcy5zcGVlZCA9IDAuNTtcblx0XHR0aGlzLmNhbnZhc09mZnNldCA9IGNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0O1x0XG5cblx0XHR2YXIgdCA9IHRoaXM7XG5cdFx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZnVuY3Rpb24oZXZlbnQpIHtcblx0XHRcdFxuXHRcdFx0Ly8gbW92ZSBwYWRkbGUgcG9zIGxlZnQgaWYgbGVmdCBidXR0b24gcHJlc3NlZFxuXHRcdFx0aWYoZXZlbnQua2V5Q29kZSA9PSAzNykge1xuXHRcdFx0XHR0LnZlbFggPSAtdC5zcGVlZDtcblx0XHRcdH1cblx0XHRcdC8vbW92ZSBwYWRkbGUgcG9zIHJpZ2h0IGlmIHJpZ2h0IGJ1dHRvbiBwcmVzc2VkXG5cdFx0XHRlbHNlIGlmKGV2ZW50LmtleUNvZGUgPT0gMzkpIHtcblx0XHRcdFx0dC52ZWxYID0gdC5zcGVlZDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCBmdW5jdGlvbihldmVudCkge1xuXHRcdFx0Ly8gbW92ZSBwYWRkbGUgcG9zIGxlZnQgaWYgbGVmdCBidXR0b24gcHJlc3NlZFxuXHRcdFx0aWYoZXZlbnQua2V5Q29kZSA9PSAzNyB8fCBldmVudC5rZXlDb2RlID09IDM5KSB7XG5cdFx0XHRcdHQudmVsWCA9IDA7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHR9KTtcblxuXHRcdC8vIEV2ZW50IEhhbmRsZXJzIGZvciBwYWRkbGUgY29udHJvbFxuXHRcdGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG5cdFx0XHR2YXIgeCA9IGV2ZW50LmNsaWVudFggLSB0LmNhbnZhc09mZnNldDtcblx0XHRcdHQucG9zWCA9IHg7XG5cdFx0fSk7XG5cdFx0XG5cdH1cblx0XG5cdC8qIFVwZGF0ZSBwYWRkbGUgcG9zaXRpb24gKi9cblx0dXBkYXRlUG9zaXRpb24oKSB7XG5cdFx0Ly8gY29uc29sZS5sb2codGhpcy52ZWxYKTtcblx0XHR0aGlzLnBvc1ggKz0gdGhpcy52ZWxYICogaW50ZXJ2YWw7XG5cdFx0dGhpcy5wb3NYID0gdGhpcy5wb3NYID49IGNhbnZhc1dpZHRoIC0gdGhpcy53aWR0aCA/IGNhbnZhc1dpZHRoIC0gdGhpcy53aWR0aCA6IHRoaXMucG9zWDtcblx0XHR0aGlzLnBvc1ggPSB0aGlzLnBvc1ggPD0gMCA/IDAgOiB0aGlzLnBvc1g7XG5cdH1cblxuXHRnZXQocHJvcGVydHkpIHtcblx0XHRyZXR1cm4gdGhpc1twcm9wZXJ0eV07XG5cdH1cblx0XG59XG5cbmNsYXNzIEJsb2NrIHtcblx0Y29uc3RydWN0b3IoaWQsIGxldmVsLCBhY3RpdmUsIGNvbG91ciwgcG9zWCwgcG9zWSwgd2lkdGgsIGhlaWdodCkge1xuXHRcdHRoaXMuaWQgPSBpZDtcblx0XHR0aGlzLmxldmVsID0gbGV2ZWw7XG5cdFx0dGhpcy5hY3RpdmUgPSBhY3RpdmU7XG5cdFx0dGhpcy5jb2xvdXIgPSBjb2xvdXI7XG5cdFx0dGhpcy5wb3NYID0gcG9zWDtcblx0XHR0aGlzLnBvc1kgPSBwb3NZO1xuXHRcdHRoaXMud2lkdGggPSB3aWR0aDtcblx0XHR0aGlzLmhlaWdodCA9IGhlaWdodDtcblx0fVxuXHRnZXQgKHByb3BlcnR5KSB7XG5cdFx0cmV0dXJuIHRoaXNbcHJvcGVydHldO1xuXHR9XG5cblx0YmxvY2tIaXQoYmFsbCkge1xuXHRcdHZhciBoaXQgPSBmYWxzZTtcblx0XHR2YXIgYmxvY2tTZWN0aW9uID0gdGhpcy5wb3NZICsgdGhpcy5oZWlnaHQ7XG5cdFx0XG5cdFx0aWYoYmFsbC5wb3NZIC0gYmFsbC5yYWRpdXMgPD0gYmxvY2tTZWN0aW9uICYmIHRoaXMuYWN0aXZlKSB7XG5cdFx0XHQvL2l0ZXJhdGUgb3ZlciB0aGUgY2lyY3VtZmVyZW5jZSBvZiB0aGUgYmFsbCBhbmQgY2hlY2sgaWYgYW55IG9mIHRoZSBwb2ludHMgYXJlIGluc2lkZSB0aGUgcmVjdGFuZ2xlXG5cdFx0XHRmb3IodmFyIGkgPSAwOyBpIDwgMzYwOyBpKyspIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcblx0XHRcdFx0dmFyIHggPSBiYWxsLnBvc1ggKyBiYWxsLnJhZGl1cyAqIE1hdGguY29zKGkgKiBNYXRoLlBJLzE4MCk7XG5cdFx0XHRcdHZhciB5ID0gYmFsbC5wb3NZIC0gIGJhbGwucmFkaXVzICogTWF0aC5zaW4oaSAqIE1hdGguUEkvMTgwKTtcblxuXHRcdFx0XHRpZih4ID49IHRoaXMucG9zWCAmJiB4IDw9IHRoaXMucG9zWCArIHRoaXMud2lkdGgpIHtcblx0XHRcdFx0XHRpZih5IDw9IHRoaXMucG9zWSArIHRoaXMuaGVpZ2h0ICYmIHkgPj0gdGhpcy5wb3NZKSB7XG5cdFx0XHRcdFx0XHRoaXQgPSB0cnVlO1xuXHRcdFx0XHRcdFx0YmFsbC52ZWxZICo9IC0xO1xuXHRcdFx0XHRcdFx0Ly8gc2NvcmUgKz0gKDQwIC0gMTAqdGhpcy5sZXZlbCArIDEpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XHRcdFxuXHRcdH1cblx0XHRpZihoaXQpIHtcblx0XHRcdHRoaXMuYWN0aXZlID0gZmFsc2U7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9IFxuXHRcdHJldHVybiBmYWxzZTtcdFxuXHR9XG59XG5cbmNsYXNzIEJsb2NrcyB7XG5cdGNvbnN0cnVjdG9yKHNjb3JlQm9hcmQpIHtcblx0XHR0aGlzLnNjb3JlQm9hcmQgPSBzY29yZUJvYXJkO1xuXHRcdHRoaXMuYmxvY2tBcnIgPSB0aGlzLmdlbmVyYXRlQmxvY2tzKCk7XG5cdH1cblxuXHQvKiBHZW5lcmF0ZSB0aGUgaW50aWFsIGJsb2NrcyAqL1xuXHRnZW5lcmF0ZUJsb2NrcygpIHtcblx0XHQvLyBjb25zb2xlLmxvZyhcImJsb2NrcyBnZW5lcmF0ZWRcIik7XG5cdFx0dmFyIHdpZHRoID0gNDM7XG5cdFx0dmFyIGhlaWdodCA9IDI1O1xuXHRcdHZhciBwb3NYID0gMDtcblx0XHR2YXIgcG9zWSA9IDA7XG5cdFx0dmFyIGJsb2NrQ29sb3VycyA9IFsncmVkJywgJyMwNjRkZjEnLCAnIzMzZjEwNicsICcjODAzN2RkJywgJ3llbGxvdyddO1xuXHRcdHZhciBpbmRleCA9IDA7XG5cdFx0dmFyIGJsb2NrQXJyYXkgPSBbXVxuXHRcdGZvcih2YXIgaSA9IDA7IGkgPCA1OyBpKyspIHtcblx0XHRcdHBvc1ggPSAxMjtcblx0XHRcdHBvc1kgKz0gaGVpZ2h0ICsgNTtcblx0XHRcdGZvcih2YXIgaiA9IDA7IGogPCAxMDsgaisrKSB7XHRcblx0XHRcdFx0dmFyIGJsb2NrID0gbmV3IEJsb2NrKGluZGV4LCBpLCB0cnVlLCBibG9ja0NvbG91cnNbaV0sIHBvc1gsIHBvc1ksIHdpZHRoLCBoZWlnaHQpO1xuXHRcdFx0XHRibG9ja0FycmF5LnB1c2goYmxvY2spO1xuXHRcdFx0XHRwb3NYICs9IHdpZHRoICsgNTtcblx0XHRcdFx0aW5kZXgrKztcblx0XHRcdH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcblx0XHR9XG5cdFx0ICAgICAgICAgIFxuXHRcdC8vIGNvbnNvbGUubG9nKGJsb2NrQXJyYXkpO1xuXHRcdHJldHVybiBibG9ja0FycmF5OyAgICAgICAgICAgICAgXG5cdH1cblx0cmVzZXRCbG9ja3MoKSB7XG5cdFx0Zm9yKHZhciBpID0gMDsgaSA8IHRoaXMuYmxvY2tBcnIubGVuZ3RoOyBpKyspIHtcblx0XHRcdHRoaXMuYmxvY2tBcnJbaV0uYWN0aXZlID0gdHJ1ZTtcblx0XHR9XG5cdH1cblx0dXBkYXRlQmxvY2tzKGJhbGwpIHtcblx0XHR2YXIgbXVsdGlIaXRzID0gMDtcblx0XHR2YXIgbm9Nb3JlQmxvY2tzID0gZmFsc2U7XG5cdFx0Zm9yKHZhciBpID0gMDsgaSA8IHRoaXMuYmxvY2tBcnIubGVuZ3RoOyBpKyspIHtcblx0XHRcdC8vIGNvbnNvbGUubG9nKHRoaXMuYmxvY2tzQXJyW2ldKTtcblx0XHRcdGlmKHRoaXMuYmxvY2tBcnJbaV0uYWN0aXZlICYmIHRoaXMuYmxvY2tBcnJbaV0uYmxvY2tIaXQoYmFsbCkpIHtcblx0XHRcdFx0bXVsdGlIaXRzKys7XG5cdFx0XHRcdGlmKG11bHRpSGl0cyA+IDEpIGJhbGwudmVsWSAqPSAtMTtcblx0XHRcdFx0dGhpcy5zY29yZUJvYXJkLnVwZGF0ZVNjb3JlKDQwIC0gMTAqdGhpcy5ibG9ja0FycltpXS5sZXZlbCArIDEpO1xuXHRcdFx0fVxuXHRcdFx0bm9Nb3JlQmxvY2tzID0gdGhpcy5ibG9ja0FycltpXS5hY3RpdmUgPyBmYWxzZSA6IHRydWU7XG5cdFx0fVxuXHRcdC8vIGNoZWNrIGlmIHRoZXJlIGFyZSBhbnkgYmxvY2tzIHJlbWFpbmluZ1xuXHRcdGlmKG5vTW9yZUJsb2NrcykgeyBcblx0XHRcdGNvbnNvbGUubG9nKCdvdmVyJyk7XG5cdFx0XHRkb2N1bWVudC5kaXNwYXRjaEV2ZW50KGdhbWVPdmVyKTtcblx0XHR9XG5cdH0gICBcblxuXHRnZXQgKHByb3BlcnR5KSB7XG5cdFx0Y29uc29sZS5sb2cocHJvcGVydHkpXG5cdFx0cmV0dXJuIHRoaXNbcHJvcGVydHldO1xuXHR9XG59XG5cbi8vIERvIHNoaXQgaGVyZVxuXG52YXIgZ2FtZSA9IG5ldyBHYW1lKCk7XG5nYW1lLnN0YXJ0R2FtZSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
